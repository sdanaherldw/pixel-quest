// Sprite generation and rendering for Pixel Quest

class SpriteManager {
    constructor() {
        this.sprites = {};
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
    }

    init() {
        this.generateAllSprites();
    }

    // Create a sprite from pixel data
    createSprite(width, height, pixelData, palette) {
        this.canvas.width = width;
        this.canvas.height = height;
        this.ctx.clearRect(0, 0, width, height);

        for (let y = 0; y < height; y++) {
            for (let x = 0; x < width; x++) {
                const colorIndex = pixelData[y * width + x];
                if (colorIndex !== 0 && palette[colorIndex]) {
                    this.ctx.fillStyle = palette[colorIndex];
                    this.ctx.fillRect(x, y, 1, 1);
                }
            }
        }

        const imageData = this.ctx.getImageData(0, 0, width, height);
        const sprite = document.createElement('canvas');
        sprite.width = width;
        sprite.height = height;
        sprite.getContext('2d').putImageData(imageData, 0, 0);
        return sprite;
    }

    generateAllSprites() {
        this.generatePlayerSprites();
        this.generateEnemySprites();
        this.generateItemSprites();
        this.generateEnvironmentSprites();
        this.generateBossSprites();
    }

    generatePlayerSprites() {
        const palette = {
            1: '#E85D04', // Orange (body)
            2: '#FFBA08', // Yellow (accent)
            3: '#FFDAB9', // Skin
            4: '#4A4A4A', // Dark (outline/shoes)
            5: '#FFFFFF', // White (eyes)
            6: '#2196F3'  // Blue (powered up)
        };

        // Player idle frame 1 (16x16)
        const idle1 = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,
            0,0,0,0,3,5,3,3,3,5,3,0,0,0,0,0,
            0,0,0,0,3,3,3,4,3,3,3,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,1,1,1,2,2,2,1,1,1,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,3,1,1,1,1,1,1,1,3,0,0,0,0,
            0,0,0,3,0,1,1,1,1,1,0,3,0,0,0,0,
            0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,
            0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,
            0,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        // Player idle frame 2 (breathing animation)
        const idle2 = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,
            0,0,0,0,3,5,3,3,3,5,3,0,0,0,0,0,
            0,0,0,0,3,3,3,4,3,3,3,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,1,1,1,2,2,2,1,1,1,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,3,1,1,1,1,1,1,1,3,0,0,0,0,
            0,0,0,3,0,1,1,1,1,1,0,3,0,0,0,0,
            0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,
            0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,
            0,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        // Player run frame 1
        const run1 = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,
            0,0,0,0,3,5,3,3,3,5,3,0,0,0,0,0,
            0,0,0,0,3,3,3,4,3,3,3,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,1,1,1,2,2,2,1,1,1,0,0,0,0,0,
            0,0,1,1,1,1,1,1,1,1,0,3,0,0,0,0,
            0,0,3,1,1,1,1,1,1,0,0,3,0,0,0,0,
            0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,
            0,0,0,4,4,0,0,0,4,4,0,0,0,0,0,0,
            0,0,4,4,0,0,0,0,0,4,4,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        // Player run frame 2
        const run2 = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,
            0,0,0,0,3,5,3,3,3,5,3,0,0,0,0,0,
            0,0,0,0,3,3,3,4,3,3,3,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,0,1,1,2,2,2,1,1,1,0,0,0,0,
            0,0,0,3,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,3,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,
            0,0,0,0,0,4,4,0,0,4,4,0,0,0,0,0,
            0,0,0,0,4,4,0,0,0,0,4,4,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        // Player jump
        const jump = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,
            0,0,0,0,3,5,3,3,3,5,3,0,0,0,0,0,
            0,0,0,0,3,3,3,4,3,3,3,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,
            0,0,3,0,1,1,1,1,1,1,1,0,3,0,0,0,
            0,3,0,1,1,1,2,2,2,1,1,1,0,3,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,4,4,0,0,0,4,4,0,0,0,0,0,
            0,0,0,4,4,0,0,0,0,0,4,4,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        // Player fall
        const fall = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,
            0,0,0,0,3,5,3,3,3,5,3,0,0,0,0,0,
            0,0,0,0,3,3,3,4,3,3,3,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,1,1,1,2,2,2,1,1,1,0,0,0,0,
            0,3,0,1,1,1,1,1,1,1,1,1,0,3,0,0,
            0,0,3,0,1,1,1,1,1,1,1,0,3,0,0,0,
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,0,4,4,4,4,4,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        this.sprites.player = {
            idle: [
                this.createSprite(16, 16, idle1, palette),
                this.createSprite(16, 16, idle2, palette)
            ],
            run: [
                this.createSprite(16, 16, run1, palette),
                this.createSprite(16, 16, run2, palette)
            ],
            jump: this.createSprite(16, 16, jump, palette),
            fall: this.createSprite(16, 16, fall, palette)
        };

        // Powered up player (blue tint)
        const poweredPalette = { ...palette, 1: '#2196F3', 2: '#64B5F6' };
        this.sprites.playerPowered = {
            idle: [
                this.createSprite(16, 16, idle1, poweredPalette),
                this.createSprite(16, 16, idle2, poweredPalette)
            ],
            run: [
                this.createSprite(16, 16, run1, poweredPalette),
                this.createSprite(16, 16, run2, poweredPalette)
            ],
            jump: this.createSprite(16, 16, jump, poweredPalette),
            fall: this.createSprite(16, 16, fall, poweredPalette)
        };
    }

    generateEnemySprites() {
        // Walker enemy (like a Goomba)
        const walkerPalette = {
            1: '#8B4513', // Brown body
            2: '#654321', // Dark brown
            3: '#FFDAB9', // Face
            4: '#000000', // Eyes
            5: '#FFD700'  // Feet
        };

        const walker1 = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,1,1,3,3,1,1,1,3,3,1,1,0,0,0,
            0,0,1,3,3,4,3,1,3,4,3,3,1,0,0,0,
            0,0,1,3,3,3,3,3,3,3,3,3,1,0,0,0,
            0,0,1,1,3,3,3,3,3,3,3,1,1,0,0,0,
            0,0,0,1,1,1,2,2,2,1,1,1,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,2,2,1,1,1,2,2,0,0,0,0,0,
            0,0,0,2,2,0,0,0,0,0,2,2,0,0,0,0,
            0,0,5,5,0,0,0,0,0,0,0,5,5,0,0,0,
            0,5,5,5,0,0,0,0,0,0,0,5,5,5,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        const walker2 = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,1,1,3,3,1,1,1,3,3,1,1,0,0,0,
            0,0,1,3,3,4,3,1,3,4,3,3,1,0,0,0,
            0,0,1,3,3,3,3,3,3,3,3,3,1,0,0,0,
            0,0,1,1,3,3,3,3,3,3,3,1,1,0,0,0,
            0,0,0,1,1,1,2,2,2,1,1,1,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,2,2,1,1,1,2,2,0,0,0,0,0,
            0,0,2,2,0,0,0,0,0,0,0,2,2,0,0,0,
            0,0,5,5,0,0,0,0,0,0,0,5,5,0,0,0,
            0,0,5,5,5,0,0,0,0,0,5,5,5,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        this.sprites.walker = [
            this.createSprite(16, 16, walker1, walkerPalette),
            this.createSprite(16, 16, walker2, walkerPalette)
        ];

        // Jumper enemy (like a slime)
        const jumperPalette = {
            1: '#32CD32', // Green
            2: '#228B22', // Dark green
            3: '#FFFFFF', // Eyes
            4: '#000000'  // Pupils
        };

        const jumper1 = [
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,
            0,0,1,1,1,3,3,1,1,3,3,1,1,1,0,0,
            0,0,1,1,1,3,4,1,1,4,3,1,1,1,0,0,
            0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
            0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
            0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
            0,1,2,1,1,1,1,1,1,1,1,1,1,2,1,0,
            0,0,2,2,1,1,1,1,1,1,1,1,2,2,0,0,
            0,0,0,2,2,2,2,2,2,2,2,2,2,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        const jumper2 = [
            0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,
            0,0,1,1,1,3,3,1,1,3,3,1,1,1,0,0,
            0,0,1,1,1,3,4,1,1,4,3,1,1,1,0,0,
            0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
            0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
            0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
            0,1,2,1,1,1,1,1,1,1,1,1,1,2,1,0,
            0,0,2,2,2,1,1,1,1,1,1,2,2,2,0,0,
            0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        this.sprites.jumper = [
            this.createSprite(16, 16, jumper1, jumperPalette),
            this.createSprite(16, 16, jumper2, jumperPalette)
        ];

        // Shooter enemy
        const shooterPalette = {
            1: '#9400D3', // Purple
            2: '#6A0DAD', // Dark purple
            3: '#FF0000', // Red eye
            4: '#FFD700', // Yellow
            5: '#4A4A4A'  // Cannon
        };

        const shooter = [
            0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,1,1,4,4,4,1,1,0,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
            0,0,1,1,1,3,3,1,1,1,1,1,1,0,0,0,
            0,5,5,5,5,3,3,1,1,1,1,1,1,0,0,0,
            0,5,5,5,5,3,3,1,1,1,1,1,1,0,0,0,
            0,0,1,1,1,3,3,1,1,1,1,1,1,0,0,0,
            0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
            0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,
            0,0,0,0,2,2,2,2,2,2,2,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        this.sprites.shooter = this.createSprite(16, 16, shooter, shooterPalette);

        // Projectile
        const projectilePalette = { 1: '#FF4500', 2: '#FFD700' };
        const projectile = [
            0,0,0,0,0,0,0,0,
            0,0,1,1,1,1,0,0,
            0,1,2,2,2,2,1,0,
            0,1,2,2,2,2,1,0,
            0,1,2,2,2,2,1,0,
            0,1,2,2,2,2,1,0,
            0,0,1,1,1,1,0,0,
            0,0,0,0,0,0,0,0
        ];
        this.sprites.projectile = this.createSprite(8, 8, projectile, projectilePalette);
    }

    generateItemSprites() {
        // Coin
        const coinPalette = { 1: '#FFD700', 2: '#FFA500', 3: '#FFFF00' };
        const coin1 = [
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,1,1,3,3,1,1,0,0,0,0,0,0,0,0,
            0,1,1,3,3,3,3,1,1,0,0,0,0,0,0,0,
            0,1,3,3,1,1,3,3,1,0,0,0,0,0,0,0,
            1,1,3,1,1,1,1,3,1,1,0,0,0,0,0,0,
            1,3,3,1,1,1,1,3,3,1,0,0,0,0,0,0,
            1,3,3,1,1,1,1,3,3,1,0,0,0,0,0,0,
            1,3,3,1,1,1,1,3,3,1,0,0,0,0,0,0,
            1,3,3,1,1,1,1,3,3,1,0,0,0,0,0,0,
            1,1,3,1,1,1,1,3,1,1,0,0,0,0,0,0,
            0,1,3,3,1,1,3,3,1,0,0,0,0,0,0,0,
            0,1,1,3,3,3,3,1,1,0,0,0,0,0,0,0,
            0,0,1,1,2,2,1,1,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        const coin2 = [
            0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,
            0,0,0,1,3,3,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,3,3,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,
            0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];

        this.sprites.coin = [
            this.createSprite(16, 16, coin1, coinPalette),
            this.createSprite(16, 16, coin2, coinPalette)
        ];

        // Power-ups
        // Speed boost (lightning)
        const speedPalette = { 1: '#FFD700', 2: '#FFA500', 3: '#FFFF00' };
        const speedBoost = [
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,
            0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,
            0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,
            0,0,0,3,3,1,1,1,1,0,0,0,0,0,0,0,
            0,0,3,3,1,1,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,
            0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,
            0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,
            0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,
            0,0,1,1,2,0,0,0,0,0,0,0,0,0,0,0,
            0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.speedBoost = this.createSprite(16, 16, speedBoost, speedPalette);

        // Double jump (wing)
        const wingPalette = { 1: '#87CEEB', 2: '#4169E1', 3: '#FFFFFF' };
        const doubleJump = [
            0,0,0,0,3,3,0,0,0,0,3,3,0,0,0,0,
            0,0,0,3,1,1,3,0,0,3,1,1,3,0,0,0,
            0,0,3,1,1,1,1,3,3,1,1,1,1,3,0,0,
            0,3,1,1,1,1,1,1,1,1,1,1,1,1,3,0,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            0,3,1,1,1,1,1,1,1,1,1,1,1,1,3,0,
            0,0,3,1,1,1,2,2,2,2,1,1,1,3,0,0,
            0,0,0,3,2,2,2,2,2,2,2,2,3,0,0,0,
            0,0,0,0,3,2,2,2,2,2,2,3,0,0,0,0,
            0,0,0,0,0,3,2,2,2,2,3,0,0,0,0,0,
            0,0,0,0,0,0,3,2,2,3,0,0,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.doubleJump = this.createSprite(16, 16, doubleJump, wingPalette);

        // Invincibility star
        const starPalette = { 1: '#FFD700', 2: '#FFA500', 3: '#FFFF00' };
        const star = [
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            0,3,1,1,1,1,1,1,1,1,1,1,1,1,3,0,
            0,0,3,1,1,1,1,1,1,1,1,1,1,3,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,
            0,0,0,1,1,1,1,2,2,1,1,1,1,0,0,0,
            0,0,0,1,1,1,2,2,2,2,1,1,1,0,0,0,
            0,0,1,1,1,2,2,0,0,2,2,1,1,1,0,0,
            0,1,1,1,2,2,0,0,0,0,2,2,1,1,1,0,
            0,1,1,2,2,0,0,0,0,0,0,2,2,1,1,0,
            1,1,2,2,0,0,0,0,0,0,0,0,2,2,1,1,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.star = this.createSprite(16, 16, star, starPalette);

        // Size/power mushroom
        const mushroomPalette = { 1: '#FF0000', 2: '#8B0000', 3: '#FFFFFF', 4: '#FFDAB9' };
        const mushroom = [
            0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,
            0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,
            0,0,1,1,3,3,1,1,1,3,3,1,1,1,0,0,
            0,1,1,3,3,3,3,1,3,3,3,3,1,1,1,0,
            0,1,1,3,3,3,3,1,3,3,3,3,1,1,1,0,
            1,1,1,1,3,3,1,1,1,3,3,1,1,1,1,1,
            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
            1,2,1,1,1,1,1,1,1,1,1,1,1,1,2,1,
            0,2,2,1,1,1,1,1,1,1,1,1,1,2,2,0,
            0,0,2,2,4,4,4,4,4,4,4,4,2,2,0,0,
            0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,
            0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,
            0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,
            0,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.mushroom = this.createSprite(16, 16, mushroom, mushroomPalette);

        // Heart (extra life)
        const heartPalette = { 1: '#FF0000', 2: '#8B0000', 3: '#FF69B4' };
        const heart = [
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,1,1,1,0,0,0,0,0,1,1,1,0,0,0,
            0,1,3,3,1,1,0,0,0,1,3,3,1,1,0,0,
            1,3,3,3,3,1,1,0,1,3,3,3,3,1,1,0,
            1,3,3,3,3,3,1,1,3,3,3,3,3,1,1,0,
            1,3,3,3,3,3,3,3,3,3,3,3,3,1,1,0,
            1,1,3,3,3,3,3,3,3,3,3,3,1,1,0,0,
            0,1,1,3,3,3,3,3,3,3,3,1,1,0,0,0,
            0,0,1,1,3,3,3,3,3,3,1,1,0,0,0,0,
            0,0,0,1,1,3,3,3,3,1,1,0,0,0,0,0,
            0,0,0,0,1,1,3,3,1,1,0,0,0,0,0,0,
            0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.heart = this.createSprite(16, 16, heart, heartPalette);
    }

    generateEnvironmentSprites() {
        // Ground tile
        const groundPalette = { 1: '#8B4513', 2: '#654321', 3: '#228B22', 4: '#90EE90' };
        const ground = [
            3,3,4,3,3,3,4,4,3,3,4,3,3,4,3,3,
            3,4,3,3,4,3,3,3,4,3,3,4,3,3,4,3,
            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
            1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,
            1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,
            1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,
            1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,
            1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,
            2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,
            1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,
            1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,
            1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,1,
            1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,
            1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,
            2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1
        ];
        this.sprites.ground = this.createSprite(16, 16, ground, groundPalette);

        // Stone platform
        const stonePalette = { 1: '#808080', 2: '#696969', 3: '#A9A9A9' };
        const stone = [
            3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            3,1,1,2,1,1,1,2,2,1,1,1,2,1,1,3,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            3,1,1,1,1,2,1,1,1,1,2,1,1,1,1,3,
            3,1,2,1,1,1,1,1,1,1,1,1,1,2,1,3,
            3,1,1,1,1,1,1,2,1,1,1,1,1,1,1,3,
            3,1,1,1,2,1,1,1,1,1,2,1,1,1,1,3,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            3,1,1,1,1,1,2,1,1,2,1,1,1,1,1,3,
            3,1,2,1,1,1,1,1,1,1,1,1,2,1,1,3,
            3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,
            3,1,1,1,1,2,1,1,1,1,1,2,1,1,1,3,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
        ];
        this.sprites.stone = this.createSprite(16, 16, stone, stonePalette);

        // Brick
        const brickPalette = { 1: '#B22222', 2: '#8B0000', 3: '#CD5C5C' };
        const brick = [
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,
            1,3,1,1,1,1,1,2,1,1,1,3,1,1,1,2,
            1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,
            1,1,1,2,1,3,1,1,1,1,1,2,1,1,3,1,
            1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,
            1,1,3,1,1,1,1,2,1,1,1,1,3,1,1,2,
            1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,
            1,3,1,2,1,1,1,3,1,1,1,2,1,1,1,1,
            1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1
        ];
        this.sprites.brick = this.createSprite(16, 16, brick, brickPalette);

        // Spike hazard
        const spikePalette = { 1: '#A9A9A9', 2: '#696969', 3: '#D3D3D3' };
        const spike = [
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,
            0,0,0,0,0,1,1,2,2,1,1,0,0,0,0,0,
            0,0,0,3,0,1,1,2,2,1,1,0,3,0,0,0,
            0,0,0,1,1,1,1,2,2,1,1,1,1,0,0,0,
            0,0,0,1,1,1,1,2,2,1,1,1,1,0,0,0,
            0,0,1,1,2,1,1,2,2,1,1,2,1,1,0,0,
            0,0,1,1,2,1,1,2,2,1,1,2,1,1,0,0,
            0,1,1,1,2,1,1,2,2,1,1,2,1,1,1,0,
            0,1,1,1,2,1,1,2,2,1,1,2,1,1,1,0,
            1,1,1,1,2,1,1,2,2,1,1,2,1,1,1,1,
            1,1,1,1,2,1,1,2,2,1,1,2,1,1,1,1,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
        ];
        this.sprites.spike = this.createSprite(16, 16, spike, spikePalette);

        // Flag/goal
        const flagPalette = { 1: '#228B22', 2: '#32CD32', 3: '#8B4513', 4: '#FFD700' };
        const flag = [
            0,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,
            0,0,0,0,4,2,2,2,2,2,2,4,0,0,0,0,
            0,0,0,0,4,2,1,1,1,1,2,4,0,0,0,0,
            0,0,0,0,4,2,1,2,2,1,2,4,0,0,0,0,
            0,0,0,0,4,2,1,2,2,1,2,4,0,0,0,0,
            0,0,0,0,4,2,1,1,1,1,2,4,0,0,0,0,
            0,0,0,0,4,2,2,2,2,2,2,4,0,0,0,0,
            0,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,
            0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,0,
            0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0
        ];
        this.sprites.flag = this.createSprite(16, 16, flag, flagPalette);

        // Moving platform
        const movingPlatPalette = { 1: '#4169E1', 2: '#1E90FF', 3: '#87CEEB' };
        const movingPlatform = [
            3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
            3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,
            2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,
            2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,
            2,1,1,2,1,1,2,1,1,2,1,1,2,1,1,2,
            2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,
            2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,
            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.movingPlatform = this.createSprite(16, 16, movingPlatform, movingPlatPalette);

        // Crumbling platform
        const crumblePalette = { 1: '#DEB887', 2: '#D2691E', 3: '#F5DEB3' };
        const crumblingPlatform = [
            3,3,0,3,3,0,3,3,0,3,3,0,3,3,0,3,
            3,1,1,1,1,0,1,1,1,1,0,1,1,1,1,3,
            1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
            1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,
            1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,
            1,2,1,1,1,1,1,1,1,1,1,1,1,2,1,1,
            1,1,1,1,2,1,1,1,2,1,1,1,1,1,1,1,
            2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
            0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ];
        this.sprites.crumblingPlatform = this.createSprite(16, 16, crumblingPlatform, crumblePalette);
    }

    generateBossSprites() {
        const bossPalette = {
            1: '#8B0000', // Dark red
            2: '#FF0000', // Red
            3: '#FFD700', // Gold
            4: '#FFFFFF', // White
            5: '#000000', // Black
            6: '#FF4500'  // Orange
        };

        // Boss sprite (32x32)
        const boss = [];
        for (let y = 0; y < 32; y++) {
            for (let x = 0; x < 32; x++) {
                // Create a menacing boss shape
                const cx = x - 16;
                const cy = y - 16;
                const dist = Math.sqrt(cx * cx + cy * cy);

                if (dist < 14) {
                    // Body
                    if (dist < 12) {
                        // Inner body
                        if (y < 12 && Math.abs(cx) < 4) {
                            boss.push(6); // Crown spikes
                        } else if (y > 8 && y < 16 && ((x > 6 && x < 12) || (x > 20 && x < 26))) {
                            // Eyes
                            if ((x > 7 && x < 11) || (x > 21 && x < 25)) {
                                if (y > 10 && y < 14) {
                                    boss.push(5); // Pupils
                                } else {
                                    boss.push(4); // White of eyes
                                }
                            } else {
                                boss.push(2);
                            }
                        } else if (y > 18 && y < 24 && x > 10 && x < 22) {
                            // Mouth
                            if (y > 19 && y < 23 && x > 11 && x < 21) {
                                boss.push(5); // Inside mouth
                            } else {
                                boss.push(3); // Teeth outline
                            }
                        } else {
                            boss.push(2);
                        }
                    } else {
                        boss.push(1); // Outline
                    }
                } else if (y > 24 && (x < 8 || x > 24)) {
                    // Feet/base
                    boss.push(1);
                } else {
                    boss.push(0);
                }
            }
        }

        this.sprites.boss = this.createSprite(32, 32, boss, bossPalette);

        // Boss projectile
        const bossProjectilePalette = { 1: '#FF0000', 2: '#FF4500', 3: '#FFD700' };
        const bossProjectile = [
            0,0,0,1,1,0,0,0,
            0,0,1,2,2,1,0,0,
            0,1,2,3,3,2,1,0,
            1,2,3,3,3,3,2,1,
            1,2,3,3,3,3,2,1,
            0,1,2,3,3,2,1,0,
            0,0,1,2,2,1,0,0,
            0,0,0,1,1,0,0,0
        ];
        this.sprites.bossProjectile = this.createSprite(8, 8, bossProjectile, bossProjectilePalette);
    }

    getSprite(name) {
        return this.sprites[name];
    }
}

const Sprites = new SpriteManager();
